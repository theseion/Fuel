<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Until now, each Fuel version has its own stream format. Furthermore, each version is not compatible with the others. This means that when upgrading Fuel version, we will need to convert our serialized streams. We include below an example of migration. Let&rsquo;s say we have some files serialized with Fuel 1.7 in a Pharo 1.4 image and we want to migrate them to Fuel 1.9.
| oldVersion newVersion fileNames objectsByFileName materializerClass serializerClass | oldVersion := '1."><meta name=theme-color content="#FFFFFF"><meta property="og:title" content><meta property="og:description" content="Until now, each Fuel version has its own stream format. Furthermore, each version is not compatible with the others. This means that when upgrading Fuel version, we will need to convert our serialized streams. We include below an example of migration. Let&rsquo;s say we have some files serialized with Fuel 1.7 in a Pharo 1.4 image and we want to migrate them to Fuel 1.9.
| oldVersion newVersion fileNames objectsByFileName materializerClass serializerClass | oldVersion := '1."><meta property="og:type" content="article"><meta property="og:url" content="https://theseion.github.io/Fuel/format-migration/"><meta property="article:section" content><meta property="article:modified_time" content="2021-06-11T12:45:53+02:00"><title>Format Migration | Fuel</title><link rel=manifest href=/Fuel/manifest.json><link rel=icon href=/Fuel/favicon.png type=image/x-icon><link rel=stylesheet href=/Fuel/book.min.4161ce72491bec8afb94acd3b81e1480e4774aca5e9e3e25c4eeeb0a4dff856a.css integrity="sha256-QWHOckkb7Ir7lKzTuB4UgOR3Sspenj4lxO7rCk3/hWo=" crossorigin=anonymous><script defer src=/Fuel/flexsearch.min.js></script>
<script defer src=/Fuel/en.search.min.60e302011b5f509025c1ab336aa33d422547aa2fef7c760668b1843190d9ed1c.js integrity="sha256-YOMCARtfUJAlwaszaqM9QiVHqi/vfHYGaLGEMZDZ7Rw=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a href=/Fuel/><img src=/Fuel/logo-fuel-header.png alt=Logo><span>Fuel</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=https://theseion.github.io/Fuel/builtin-header-support/>Builtin Header Support</a></li><li><a href=https://theseion.github.io/Fuel/customizing-the-graph/>Customizing the Graph</a></li><li><a href=https://theseion.github.io/Fuel/debugging/>Debugging</a></li><li><a href=https://theseion.github.io/Fuel/errors/>Errors</a></li><li><a href=https://theseion.github.io/Fuel/format-migration/ class=active>Format Migration</a></li><li><a href=https://theseion.github.io/Fuel/managing-globals/>Managing Globals</a></li><li><a href=https://theseion.github.io/Fuel/migration/>Migration</a></li><li><a href=https://theseion.github.io/Fuel/package-overview/>Package Overview</a></li><li><span>Releases</span><ul><li><a href=https://theseion.github.io/Fuel/releases/5.2.2/>5.2.2</a></li><li><a href=https://theseion.github.io/Fuel/releases/5.2.1/>5.2.1</a></li><li><a href=https://theseion.github.io/Fuel/releases/5.2.0/>5.2.0</a></li><li><a href=https://theseion.github.io/Fuel/releases/5.1.0/>5.1.0</a></li><li><a href=https://theseion.github.io/Fuel/releases/5.0.6/>5.0.6</a></li><li><a href=https://theseion.github.io/Fuel/releases/5.0.5/>5.0.5</a></li><li><a href=https://theseion.github.io/Fuel/releases/5.0.3/>5.0.3</a></li><li><a href=https://theseion.github.io/Fuel/releases/5.0.4/>5.0.4</a></li><li><a href=https://theseion.github.io/Fuel/releases/5.0.2/>5.0.2</a></li><li><a href=https://theseion.github.io/Fuel/releases/5.0.1/>5.0.1</a></li><li><a href=https://theseion.github.io/Fuel/releases/5.0.0/>5.0.0</a></li><li><a href=https://theseion.github.io/Fuel/releases/4.1.1/>4.1.1</a></li><li><a href=https://theseion.github.io/Fuel/releases/4.1.0/>4.1.0</a></li><li><a href=https://theseion.github.io/Fuel/releases/4.0.0/>4.0.0</a></li><li><a href=https://theseion.github.io/Fuel/releases/3.0.0/>3.0.0</a></li><li><a href=https://theseion.github.io/Fuel/releases/1.9.3/>1.9.3</a></li><li><a href=https://theseion.github.io/Fuel/releases/1.9/>1.9</a></li><li><a href=https://theseion.github.io/Fuel/releases/1.8/>1.8</a></li><li><a href=https://theseion.github.io/Fuel/releases/1.8.1/>1.8.1</a></li><li><a href=https://theseion.github.io/Fuel/releases/1.7/>1.7</a></li><li><a href=https://theseion.github.io/Fuel/releases/1.6/>1.6</a></li><li><a href=https://theseion.github.io/Fuel/releases/1.5/>1.5</a></li><li><a href=https://theseion.github.io/Fuel/releases/1.4/>1.4</a></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/Fuel/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Format Migration</strong>
<label for=toc-control><img src=/Fuel/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents></nav></aside></header><article class=markdown><p>Until now, each Fuel version has its own stream format. Furthermore, each version is not compatible with the others. This means that when upgrading Fuel version, we will need to convert our serialized streams. We include below an example of migration. Let&rsquo;s say we have some files serialized with Fuel 1.7 in a Pharo 1.4 image and we want to migrate them to Fuel 1.9.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-smalltalk data-lang=smalltalk><span style=display:flex><span> <span style=color:#f92672>|</span> oldVersion newVersion fileNames objectsByFileName 
</span></span><span style=display:flex><span>   materializerClass serializerClass <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span> oldVersion <span style=color:#f92672>:=</span> <span style=color:#e6db74>&#39;1.7&#39;</span>.
</span></span><span style=display:flex><span> newVersion <span style=color:#f92672>:=</span> <span style=color:#e6db74>&#39;1.9&#39;</span>.
</span></span><span style=display:flex><span> fileNames <span style=color:#f92672>:=</span> <span style=color:#e6db74>#(</span><span style=color:#e6db74>&#39;a.fuel&#39;</span> <span style=color:#e6db74>&#39;b.fuel&#39;</span> <span style=color:#e6db74>&#39;c.fuel&#39;</span> <span style=color:#e6db74>&#39;d.fuel&#39;</span> <span style=color:#e6db74>&#39;e.fuel&#39;</span><span style=color:#e6db74>)</span>.
</span></span><span style=display:flex><span> objectsByFileName <span style=color:#f92672>:=</span> <span style=color:#a6e22e>Dictionary</span> new.
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> (<span style=color:#a6e22e>ConfigurationOfFuel</span> <span style=color:#a6e22e>project</span> <span style=color:#a6e22e>version:</span> oldVersion) <span style=color:#a6e22e>load</span>.
</span></span><span style=display:flex><span> materializerClass <span style=color:#f92672>:=</span> <span style=color:#a6e22e>Smalltalk</span> <span style=color:#a6e22e>at:</span> <span style=color:#e6db74>#FLMaterializer</span>.
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span> fileNames <span style=color:#a6e22e>do:</span> [ <span style=color:#f92672>:</span>fileName <span style=color:#f92672>|</span> 
</span></span><span style=display:flex><span> 	objectsByFileName 
</span></span><span style=display:flex><span> 		<span style=color:#a6e22e>at:</span> fileName 
</span></span><span style=display:flex><span> 		<span style=color:#a6e22e>put:</span> (materializerClass <span style=color:#a6e22e>materializeFromFileNamed:</span> fileName) ].
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span> (<span style=color:#a6e22e>ConfigurationOfFuel</span> <span style=color:#a6e22e>project</span> <span style=color:#a6e22e>version:</span> newVersion) <span style=color:#a6e22e>load</span>.
</span></span><span style=display:flex><span> serializerClass <span style=color:#f92672>:=</span> <span style=color:#a6e22e>Smalltalk</span> <span style=color:#a6e22e>at:</span> <span style=color:#e6db74>#FLSerializer</span>.
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span> objectsByFileName <span style=color:#a6e22e>keysAndValuesDo:</span> [ <span style=color:#f92672>:</span>fileName <span style=color:#f92672>:</span>objects <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span> 	serializerClass 
</span></span><span style=display:flex><span> 		<span style=color:#a6e22e>serialize:</span> objects  
</span></span><span style=display:flex><span> 		<span style=color:#a6e22e>toFileNamed:</span> <span style=color:#e6db74>&#39;migrated-&#39;</span><span style=color:#a6e22e>,</span> fileName
</span></span><span style=display:flex><span> 	 ].
</span></span></code></pre></div><p><strong>Note 1:</strong> We assume in this example that the number of objects to migrate can be materialized all together at the same time. This can be false. In such case, we could fix the script to split the list of files and do it in parts.Note 2: It is necessary to fetch the classes in the System Dictionary after the desired Fuel version has been loaded.Note 3: This script should be evaluated in the original image. For example, we don&rsquo;t guarantee that Fuel 1.7 loads in Pharo 2.0, but we know that Fuel 1.9 loads in Pharo 1.4.</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/theseion/Fuel/commit/30f646158dec95bc10995c12d702a06ef16da709 title='Last modified by Max Leske | Jun 11, 2021' target=_blank rel=noopener><img src=/Fuel/svg/calendar.svg class=book-icon alt=Calendar>
<span>Jun 11, 2021</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents></nav></div></aside></main></body></html>